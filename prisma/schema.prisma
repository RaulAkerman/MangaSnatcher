// // This is your Prisma schema file,
// // learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Guild {
  id        String   @id
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
  channelId String

  seriesInGuild SeriesInGuild[]
  Series        Series?         @relation(fields: [seriesId], references: [id])
  seriesId      String?

  @@map("guilds")
}

model SeriesInGuild {
  id        String   @id @default(uuid())
  series    Series   @relation(fields: [seriesId], references: [id])
  seriesId  String   @map("series_id")
  guild     Guild    @relation(fields: [guildId], references: [id])
  guildId   String   @map("guild_id")
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([seriesId, guildId])
  @@map("series_in_guild")
}

model Series {
  id                String    @id @default(uuid())
  title             String
  url               String    @unique
  source            String
  latestChapter     String?   @map("latest_chapter")
  latestChapterUrl  String?  
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at")
  lastScrapedAt     DateTime? @map("last_scraped_at")

  guilds          Guild[]
  SeriesInGuild   SeriesInGuild[]

  @@map("series")
}

model LastScrape {
  id        String   @id @default(uuid())
  timestamp DateTime @default(now()) @map("timestamp")

  @@map("last_scrape")
}
